<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../bower_components/neon-animation/animations/fade-in-animation.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation-runner-behavior.html">

<dom-module id="gn-directions-menu">
  <template>
    <style>
      :host {
        display: block;
        --app-primary-color: #1B5E20;
        --app-secondary-color: black;
      }
      
      paper-tabs {
        --paper-tabs-selection-bar-color: var(--app-primary-color);
      }

      #route {
        padding: 0 20px;
      }

      paper-input {
        --paper-input-container-focus-color: var(--app-primary-color);
      }
    </style>

    <paper-tabs noink selected="{{selected}}">
      <paper-tab>ROUTE</paper-tab>
      <paper-tab>ERREICHBARKEIT</paper-tab>          
    </paper-tabs>

    <iron-pages selected="{{selected}}">
      <div id="route">
        <div>
          <paper-input label="From"></paper-input>

          <!-- Add Stopovers -->
          <template is="dom-repeat" items="{{intermediateobjects}}">
            <paper-input label="{{item.name}}" value="{{item.object}}">
              <div suffix></div>
              <paper-icon-button suffix value="{{index}}" icon="icons:delete" on-click="removeStopover"></paper-icon-button>
            </paper-input>
          </template>
          <paper-input label="To"></paper-input>
        </div>

        <div id="submenu">
          <div>
            <paper-icon-button icon="maps:add-location" on-click="addStopover"></paper-icon-button>
            <span>Add Stopovers</span>
          </div>
          <!-- Vehicle -->
          <paper-dropdown-menu label="Vehicle">
            <paper-listbox class="dropdown-content">
              <template is="dom-repeat" items="{{vehicles}}">
                <paper-item>{{item}}</paper-item>
              </template>
            </paper-listbox>
          </paper-dropdown-menu>
          <!-- Battery State -->
          <paper-input
                id="battery" label="Battery state"
                auto-validate
                pattern="100|[1-9][0-9]|[1-9]"
                error-message="Must be a percentage"
                value="{{ battery }}"><div suffix>%</div>
          </paper-input>
        </div>

        <div class="card-actions">
          <paper-icon-button icon="arrow-drop-down" id="toggleButton" on-click="toggleSubmenu"></paper-icon-button>
          <div class="right">
            <paper-icon-button 
                icon="maps:directions"
                onclick="document.querySelector('gn-api').getRoute()">
            </paper-icon-button>
          </div>
        </div>
      </div>
      <div>Page 2</div>
    </iron-pages>

  </template>
  <script>
    Polymer({
      is: 'gn-directions-menu',

      behaviors: [Polymer.NeonAnimationRunnerBehavior],
      
      properties:{
        /**
         * Controls submenu visibility 
         */
        submenuHidden: {
          type: Boolean,
          value: true,
          notify: true,
          observer: '_submenuHiddenChanged'
        },

        /**
         * Contains all stopovers
         */
        intermediateobjects: {
          type: Array,
          value: function() {
            return [];
          }
        },

        /**
         * Holds supported vehicles 
         */
        vehicles: {
          type: Array,
          notify: true
        },

        /**
         * Manages neon animations
         */
        animationConfig: {
          type: Object,
          value: function() {
            return {
              'entry': [{
                name: 'fade-in-animation',
                node: this.$.submenu,
              }],
            }
          }
        }
      },

      /**
       * Selects the 'Route' tab in the sidebar.
       */
      ready: function() {
        this.selected = 0;
      },

      /**
       * Toggles the submenuHidden property 
       */
      toggleSubmenu: function() {
        this.submenuHidden = !this.submenuHidden;
      },

      /**
       * Shows or hides the submenu including
       * vehicle type selection, stopovers, battery state 
       */
      _submenuHiddenChanged: function() {
        if (this.submenuHidden) {
          this.$.toggleButton.icon = "arrow-drop-down";
          this.$.submenu.style.display = 'none';
        }
        else {
          this.playAnimation('entry');
          this.$.toggleButton.icon = "arrow-drop-up";
          this.$.submenu.style.display = 'inline-block';
        }
      },

      /**
       * Updates the menu position
       */
      _positionChanged: function() {
        this.$.menu.style.top = this.top+'px';
        this.$.menu.style.left = this.left+'px';
      },

      /**
       * Adds a stopover object to the intermediate objects list
       */
      addStopover: function() {
          this.push('intermediateobjects', {name: "New Stopover"});
      },

      /**
       * Removes a stopover object from the intermediate objects list
       */
      removeStopover: function(event, index) {
        var index = this.intermediateobjects.indexOf(event.model.item);
        this.splice('intermediateobjects', index, 1)
      }
    });
  </script>
</dom-module>
