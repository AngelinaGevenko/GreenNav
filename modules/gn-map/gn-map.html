<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">

<link rel="stylesheet" href="ol3gm.css" type="text/css">
<link rel="stylesheet" href="https://openlayers.org/en/v3.19.1/css/ol.css" type="text/css">

<script src="https://openlayers.org/en/v3.19.1/build/ol.js" type="text/javascript"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyCURfGidiiyj4S8XFOPFftNlhfx5A6ce8o" type="text/javascript"></script>
<script type="text/javascript" src="ol3gm.js"></script>

<dom-module id="gn-map">
  <template>
    <style>
      #map {
        height: 100%;
        width: 100%;
        position: relative;
      }

      #overlayMenu {
        top: 20px;
        right: 20px;
        padding: 10px;
        background: rgba(255,255,255,0.8);
        position: absolute;
        z-index: 10;
        border-radius: 10px;
      }

      paper-icon-button {
        background-color: var(--app-primary-color);
        color: white;
        border-radius: 20px
      }
    </style>
    <div id="map" class="map">
      <div id="overlayMenu">
        <div class="layout horizontal">
          <div class="flex"></div>
          <paper-icon-button on-tap="toggleOverlay" icon="expand-less"></paper-icon-button>
        </div>
        <div hidden="{{overlayMenuHidden}}">
          <paper-dropdown-menu label="Map Type">
            <paper-listbox class="dropdown-content" selected="0">
              <paper-item>Open Street Map</paper-item>
              <paper-item>Google Map</paper-item>
            </paper-listbox>
          </paper-dropdown-menu>
        </div>        
      </div>
    </div>
  </template>
<script>
  Polymer({
    is: 'gn-map',

    properties: {
      /**
       * A latitude to center the map on.
       */
      latitude: {
        type: Number,
        notify: true,
        value: 48.139,
        reflectToAttribute: true
      },

      /**
       * A longitude to center the map on.
       */
      longitude: {
        type: Number,
        notify: true,
        value: 11.566,
        reflectToAttribute: true
      },

      /**
       * A zoom level which will be applied to the map.
       */
      zoom: {
        type: Number,
        value: 11,
        notify: true,
        reflectToAttribute: true
      },

      /**
       * The map-type is bind by dom-if template to include different type of maps
       * Possible values are "GoogleMap" or "LeafletMap".
       */
      mapType: {
        type: String,
        value:"GoogleMap",
        notify: true,
        observer: '_toggleMapType'
      },

      /**
       * Array of polygon objects.
       */
      polygons: {
        type: Array,
        readOnly: true,
      },

      /**
       * Array of Marker objects.
       */
      markers: {
        type: Array,
        readOnly: true,
      },

      /**
       * Shows weather in major cities within the map bounds if `true`.
       */
      weather: {
        type: Boolean,
        reflectToAttribute: true,
        notify: true,
        value: false,
        observer: 'toggleWeather'
      },

      /**
       * Shows a precipitation layer if `true`.
       */
      precipitation: {
        type: Boolean,
        reflectToAttribute: true,
        value: false,
        observer: 'togglePrecipitation'
      },

      /**
       * Shows a traffic layer if `true`.
       */
      traffic: {
        type: Boolean,
        reflectToAttribute: true,
        value: false,
        observer: 'toggleTraffic'
      },

      overlayMenuHidden: {
        type: Boolean,
        value: true
      },

      _map: {
        type: Object
      },

      _layers: {
        type: Object
      }
    },

    attached: function() {
      // Create a Google Maps layer
      var googleLayer = new olgm.layer.Google({
        visible: false,
        type: 'base',
        title: 'GoogleMaps'
      });

      // Create OSM Layer
      var osmLayer = new ol.layer.Tile({
        visible: true,
        type: 'base',
        title: 'OpenStreetMap',
        source: new ol.source.OSM()
      })

      var map = new ol.Map({
        interactions: olgm.interaction.defaults(),
        layers: [
          new ol.layer.Group({
            title: 'Map Types',
            layers: [
              osmLayer,
              googleLayer
            ]
          })
        ],
        target: 'map',
        view: new ol.View({
          center: ol.proj.fromLonLat([this.longitude, this.latitude]),
          zoom: this.zoom
        })
      });   

      var olGM = new olgm.OLGoogleMaps({map: map});
      olGM.activate();
    },

    /**
     * Toggles the weather icons on the map.
     *
     * @method toggleWeather
     */
    toggleWeather: function() {

    },

    /**
     * Toggles the precipitation layer on the map.
     *
     * @method togglePrecipitation
     */
    togglePrecipitation: function() {

    },

    /**
     * Toggles the traffic layer on the map.
     *
     * @method toggleTraffic
     */
    toggleTraffic: function() {

    },

    _toggleMapType: function() {

    },

    toggleOverlay: function() {
      if(this.overlayMenuHidden) {
        this.overlayMenuHidden = false;
      }
      else {
        this.overlayMenuHidden = true;
      }
    },

    /**
     * Adds a polygon to the map.
     *
     * @method addPolygon
     */
    setRoute: (points, strokeColor, width, closed, fillColor, fillOpacity) => {
     
    },

    /**
     * Adds a marker to the map.
     *
     * @method addMarker
     */
    addMarker: (latitude, longitude) => {

    }
  });
</script>

</dom-module>