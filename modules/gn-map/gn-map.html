<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<script src="https://openlayers.org/en/v3.19.1/build/ol.js" type="text/javascript"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3&key=AIzaSyCURfGidiiyj4S8XFOPFftNlhfx5A6ce8o" type="text/javascript"></script>
<script type="text/javascript" src="ol3gm.js"></script>
<link rel="stylesheet" href="ol3gm.css" type="text/css" />
<link rel="stylesheet" href="https://openlayers.org/en/v3.19.1/css/ol.css" type="text/css">

<dom-module id="gn-map">
  <template>
    <style>
      .map {
        height: 100%;
        width: 100%;
      }
    </style>
    <div id="map" class="map"></div>
  </template>
<script>
  Polymer({
    is: 'gn-map',

    properties: {
      /**
       * A latitude to center the map on.
       */
      latitude: {
        type: Number,
        notify: true,
        value: 53.834089,
        reflectToAttribute: true
      },

      /**
       * A longitude to center the map on.
       */
      longitude: {
        type: Number,
        notify: true,
        value: 10.703718,
        reflectToAttribute: true
      },

      /**
       * A zoom level which will be applied to the map.
       */
      zoom: {
        type: Number,
        value: 11,
        notify: true,
        reflectToAttribute: true
      },

      /**
       * The map-type is bind by dom-if template to include different type of maps
       * Possible values are "GoogleMap" or "LeafletMap".
       */
      mapType: {
        type: String,
        value:"GoogleMap",
        notify: true,
        observer: '_toggleMapType'
      },

      /**
       * Array of polygon objects.
       */
      polygons: {
        type: Array,
        readOnly: true,
      },

      /**
       * Array of Marker objects.
       */
      markers: {
        type: Array,
        readOnly: true,
      },

      /**
       * Shows weather in major cities within the map bounds if `true`.
       */
      weather: {
        type: Boolean,
        reflectToAttribute: true,
        notify: true,
        value: false,
        observer: 'toggleWeather'
      },

      /**
       * Shows a precipitation layer if `true`.
       */
      precipitation: {
        type: Boolean,
        reflectToAttribute: true,
        value: false,
        observer: 'togglePrecipitation'
      },

      /**
       * Shows a traffic layer if `true`.
       */
      traffic: {
        type: Boolean,
        reflectToAttribute: true,
        value: false,
        observer: 'toggleTraffic'
      },

      _map: {
        type: Object
      },

      _layers: {
        type: Object
      }
    },

    attached: function() {
      /*this._layers = [
        new ol.layer.Tile({
          //source: new ol.source.OSM()
          source: new olgm.layer.Google()
        })
      ];

      this._map = new ol.Map({
        target: 'map',
        layers: this._layers,
        view: new ol.View({
          center: ol.proj.fromLonLat([this.longitude, this.latitude]),
          zoom: this.zoom
        })
      });*/

      // Create a Google Maps layer
      var googleLayer = new olgm.layer.Google({
        visible: true
      });
      var osmLayer = new ol.layer.Tile({
        visible: false,
        source: new ol.source.OSM()
      })

      // Create a regular OL3 map, containing our Google layer
      var map = new ol.Map({
        // use OL3-Google-Maps recommended default interactions
        interactions: olgm.interaction.defaults(),
        layers: [
          googleLayer,
          osmLayer
        ],
        target: 'map',
        view: new ol.View({
          center: ol.proj.fromLonLat([this.longitude, this.latitude]),
          zoom: 12
        })
      });   

      var olGM = new olgm.OLGoogleMaps({map: map});
      olGM.activate();
    },

    /**
     * Toggles the weather icons on the map.
     *
     * @method toggleWeather
     */
    toggleWeather: function() {

    },

    /**
     * Toggles the precipitation layer on the map.
     *
     * @method togglePrecipitation
     */
    togglePrecipitation: function() {

    },

    /**
     * Toggles the traffic layer on the map.
     *
     * @method toggleTraffic
     */
    toggleTraffic: function() {

    },

    _toggleMapType: function() {

    },

    /**
     * Adds a polygon to the map.
     *
     * @method addPolygon
     */
    setRoute: (points, strokeColor, width, closed, fillColor, fillOpacity) => {
     
    },

    /**
     * Adds a marker to the map.
     *
     * @method addMarker
     */
    addMarker: (latitude, longitude) => {

    }
  });
</script>

</dom-module>